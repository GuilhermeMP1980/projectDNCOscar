import pytest
from app import app  # Certifique-se de que o nome do seu arquivo principal Ã© app.py

@pytest.fixture
def client():
    app.config["TESTING"] = True
    with app.test_client() as client:
        yield client

def test_resumo_devolucao(client):
    response = client.post("/resumo", json={"tipo": "devolucao"})
    assert response.status_code == 200
    data = response.get_json()
    assert "resposta" in data
    assert "principais_SKUs" in data
    assert isinstance(data["principais_SKUs"], dict)

def test_resumo_cancelamento(client):
    response = client.post("/resumo", json={"tipo": "cancelamento"})
    assert response.status_code == 200
    data = response.get_json()
    assert "resposta" in data
    assert "condicoes_mais_comuns" in data
    assert isinstance(data["condicoes_mais_comuns"], dict)

def test_resumo_ajustes(client):
    response = client.post("/resumo", json={"tipo": "ajustes"})
    assert response.status_code == 200
    data = response.get_json()
    assert "resposta" in data
    assert "tipos_mais_frequentes" in data
    assert isinstance(data["tipos_mais_frequentes"], dict)

def test_resumo_cruzar(client):
    response = client.post("/resumo", json={"tipo": "cruzar"})
    assert response.status_code == 200
    data = response.get_json()
    assert isinstance(data, list)
    if data:
        assert "SKU" in data[0]

def test_tipo_invalido(client):
    response = client.post("/resumo", json={"tipo": "inexistente"})
    assert response.status_code == 200
    data = response.get_json()
    assert "erro" in data
